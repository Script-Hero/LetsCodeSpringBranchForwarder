{"ast":null,"code":"'use strict';\n\nvar P = module.exports;\n\nvar spawn = require('child_process').spawn;\n\nvar spawnSync = require('child_process').spawnSync;\n\nvar promisify = require('util').promisify; // Exported for CLIs and such to override\n\n\nP.PKG_DIR = __dirname;\n\nP._loadStore = function (storeConf) {\n  return P._loadHelper(storeConf.module).then(function (plugin) {\n    return P._normalizeStore(storeConf.module, plugin.create(storeConf));\n  });\n};\n\nP._loadChallenge = function (chConfs, typ01) {\n  return P._loadHelper(chConfs[typ01].module).then(function (plugin) {\n    var ch = P._normalizeChallenge(chConfs[typ01].module, plugin.create(chConfs[typ01]));\n\n    ch._type = typ01;\n    return ch;\n  });\n};\n\nP._loadHelper = function (modname) {\n  try {\n    return Promise.resolve(require(modname));\n  } catch (e) {\n    console.error(\"Could not load '%s'\", modname);\n    console.error('Did you install it?');\n    console.error('\\tnpm install --save %s', modname);\n    e.context = 'load_plugin';\n    throw e; // Fun experiment, bad idea\n\n    /*\n    return P._install(modname).then(function() {\n    return require(modname);\n    });\n    */\n  }\n};\n\nP._normalizeStore = function (name, store) {\n  var acc = store.accounts;\n  var crt = store.certificates;\n  var warned = false;\n\n  function warn() {\n    if (warned) {\n      return;\n    }\n\n    warned = true;\n    console.warn(\"'\" + name + \"' may have incorrect function signatures, or contains deprecated use of callbacks\");\n  } // accs\n\n\n  if (acc.check && 2 === acc.check.length) {\n    warn();\n    acc._thunk_check = acc.check;\n    acc.check = promisify(acc._thunk_check);\n  }\n\n  if (acc.set && 3 === acc.set.length) {\n    warn();\n    acc._thunk_set = acc.set;\n    acc.set = promisify(acc._thunk_set);\n  }\n\n  if (2 === acc.checkKeypair.length) {\n    warn();\n    acc._thunk_checkKeypair = acc.checkKeypair;\n    acc.checkKeypair = promisify(acc._thunk_checkKeypair);\n  }\n\n  if (3 === acc.setKeypair.length) {\n    warn();\n    acc._thunk_setKeypair = acc.setKeypair;\n    acc.setKeypair = promisify(acc._thunk_setKeypair);\n  } // certs\n\n\n  if (2 === crt.check.length) {\n    warn();\n    crt._thunk_check = crt.check;\n    crt.check = promisify(crt._thunk_check);\n  }\n\n  if (3 === crt.set.length) {\n    warn();\n    crt._thunk_set = crt.set;\n    crt.set = promisify(crt._thunk_set);\n  }\n\n  if (2 === crt.checkKeypair.length) {\n    warn();\n    crt._thunk_checkKeypair = crt.checkKeypair;\n    crt.checkKeypair = promisify(crt._thunk_checkKeypair);\n  }\n\n  if (2 === crt.setKeypair.length) {\n    warn();\n    crt._thunk_setKeypair = crt.setKeypair;\n    crt.setKeypair = promisify(crt._thunk_setKeypair);\n  }\n\n  return store;\n};\n\nP._normalizeChallenge = function (name, ch) {\n  var gch = {};\n  var warned = false;\n\n  function warn() {\n    if (warned) {\n      return;\n    }\n\n    warned = true;\n    console.warn(\"'\" + name + \"' may have incorrect function signatures, or contains deprecated use of callbacks\");\n  }\n\n  var warned2 = false;\n\n  function warn2() {\n    if (warned2) {\n      return;\n    }\n\n    warned2 = true;\n    console.warn(\"'\" + name + \"' did not return a Promise when called. This should be fixed by the maintainer.\");\n  }\n\n  function wrappy(fn) {\n    return function (_params) {\n      return Promise.resolve().then(function () {\n        var result = fn.call(ch, _params);\n\n        if (!result || !result.then) {\n          warn2();\n        }\n\n        return result;\n      });\n    };\n  } // init, zones, set, get, remove, propagationDelay\n\n\n  if (ch.init) {\n    if (2 === ch.init.length) {\n      warn();\n      ch._thunk_init = ch.init;\n      ch.init = promisify(ch._thunk_init);\n    }\n\n    gch.init = wrappy(ch.init);\n  }\n\n  if (ch.zones) {\n    if (2 === ch.zones.length) {\n      warn();\n      ch._thunk_zones = ch.zones;\n      ch.zones = promisify(ch._thunk_zones);\n    }\n\n    gch.zones = wrappy(ch.zones);\n  }\n\n  if (2 === ch.set.length) {\n    warn();\n    ch._thunk_set = ch.set;\n    ch.set = promisify(ch._thunk_set);\n  }\n\n  gch.set = wrappy(ch.set);\n\n  if (2 === ch.remove.length) {\n    warn();\n    ch._thunk_remove = ch.remove;\n    ch.remove = promisify(ch._thunk_remove);\n  }\n\n  gch.remove = wrappy(ch.remove);\n\n  if (ch.get) {\n    if (2 === ch.get.length) {\n      warn();\n      ch._thunk_get = ch.get;\n      ch.get = promisify(ch._thunk_get);\n    }\n\n    gch.get = wrappy(ch.get);\n  }\n\n  if (\"number\" === typeof ch.propagationDelay) {\n    gch.propagationDelay = ch.propagationDelay;\n  }\n\n  return gch;\n};\n\nP._loadSync = function (modname) {\n  try {\n    return require(modname);\n  } catch (e) {\n    console.error(\"Could not load '%s'\", modname);\n    console.error('Did you install it?');\n    console.error('\\tnpm install --save %s', modname);\n    e.context = 'load_plugin';\n    throw e;\n  }\n  /*\n  try {\n  mod = require(modname);\n  } catch (e) {\n  P._installSync(modname);\n  mod = require(modname);\n  }\n  */\n\n};\n\nP._installSync = function (moduleName) {\n  try {\n    return require(moduleName);\n  } catch (e) {// continue\n  }\n\n  var npm = 'npm';\n  var args = ['install', '--save', moduleName];\n  var out = '';\n  var cmd;\n\n  try {\n    cmd = spawnSync(npm, args, {\n      cwd: P.PKG_DIR,\n      windowsHide: true\n    });\n  } catch (e) {\n    console.error(\"Failed to start: '\" + npm + ' ' + args.join(' ') + \"' in '\" + P.PKG_DIR + \"'\");\n    console.error(e.message);\n    process.exit(1);\n  }\n\n  if (!cmd.status) {\n    return;\n  }\n\n  out += cmd.stdout.toString('utf8');\n  out += cmd.stderr.toString('utf8');\n\n  if (out) {\n    console.error(out);\n    console.error();\n    console.error();\n  }\n\n  console.error(\"Failed to run: '\" + npm + ' ' + args.join(' ') + \"' in '\" + P.PKG_DIR + \"'\");\n  console.error('Try for yourself:\\n\\tcd ' + P.PKG_DIR + '\\n\\tnpm ' + args.join(' '));\n  process.exit(1);\n};\n\nP._install = function (moduleName) {\n  return new Promise(function (resolve) {\n    if (!moduleName) {\n      throw new Error('no module name given');\n    }\n\n    var npm = 'npm';\n    var args = ['install', '--save', moduleName];\n    var out = '';\n    var cmd = spawn(npm, args, {\n      cwd: P.PKG_DIR,\n      windowsHide: true\n    });\n    cmd.stdout.on('data', function (chunk) {\n      out += chunk.toString('utf8');\n    });\n    cmd.stdout.on('data', function (chunk) {\n      out += chunk.toString('utf8');\n    });\n    cmd.on('error', function (e) {\n      console.error(\"Failed to start: '\" + npm + ' ' + args.join(' ') + \"' in '\" + P.PKG_DIR + \"'\");\n      console.error(e.message);\n      process.exit(1);\n    });\n    cmd.on('exit', function (code) {\n      if (!code) {\n        resolve();\n        return;\n      }\n\n      if (out) {\n        console.error(out);\n        console.error();\n        console.error();\n      }\n\n      console.error(\"Failed to run: '\" + npm + ' ' + args.join(' ') + \"' in '\" + P.PKG_DIR + \"'\");\n      console.error('Try for yourself:\\n\\tcd ' + P.PKG_DIR + '\\n\\tnpm ' + args.join(' '));\n      process.exit(1);\n    });\n  });\n};\n\nif (require.main === module) {\n  P._installSync(process.argv[2]);\n}","map":{"version":3,"sources":["/home/neil/Desktop/Programming/LetsCodeSBISD/Forwarder/node_modules/@root/greenlock/plugins.js"],"names":["P","module","exports","spawn","require","spawnSync","promisify","PKG_DIR","__dirname","_loadStore","storeConf","_loadHelper","then","plugin","_normalizeStore","create","_loadChallenge","chConfs","typ01","ch","_normalizeChallenge","_type","modname","Promise","resolve","e","console","error","context","name","store","acc","accounts","crt","certificates","warned","warn","check","length","_thunk_check","set","_thunk_set","checkKeypair","_thunk_checkKeypair","setKeypair","_thunk_setKeypair","gch","warned2","warn2","wrappy","fn","_params","result","call","init","_thunk_init","zones","_thunk_zones","remove","_thunk_remove","get","_thunk_get","propagationDelay","_loadSync","_installSync","moduleName","npm","args","out","cmd","cwd","windowsHide","join","message","process","exit","status","stdout","toString","stderr","_install","Error","on","chunk","code","main","argv"],"mappings":"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","sourcesContent":["'use strict';\n\nvar P = module.exports;\n\nvar spawn = require('child_process').spawn;\nvar spawnSync = require('child_process').spawnSync;\nvar promisify = require('util').promisify;\n\n// Exported for CLIs and such to override\nP.PKG_DIR = __dirname;\n\nP._loadStore = function(storeConf) {\n    return P._loadHelper(storeConf.module).then(function(plugin) {\n        return P._normalizeStore(storeConf.module, plugin.create(storeConf));\n    });\n};\nP._loadChallenge = function(chConfs, typ01) {\n    return P._loadHelper(chConfs[typ01].module).then(function(plugin) {\n        var ch = P._normalizeChallenge(\n            chConfs[typ01].module,\n            plugin.create(chConfs[typ01])\n        );\n        ch._type = typ01;\n        return ch;\n    });\n};\nP._loadHelper = function(modname) {\n    try {\n        return Promise.resolve(require(modname));\n    } catch (e) {\n        console.error(\"Could not load '%s'\", modname);\n        console.error('Did you install it?');\n        console.error('\\tnpm install --save %s', modname);\n        e.context = 'load_plugin';\n        throw e;\n\n        // Fun experiment, bad idea\n        /*\n\t\treturn P._install(modname).then(function() {\n\t\t\treturn require(modname);\n\t\t});\n    */\n    }\n};\n\nP._normalizeStore = function(name, store) {\n    var acc = store.accounts;\n    var crt = store.certificates;\n\n    var warned = false;\n    function warn() {\n        if (warned) {\n            return;\n        }\n        warned = true;\n        console.warn(\n            \"'\" +\n                name +\n                \"' may have incorrect function signatures, or contains deprecated use of callbacks\"\n        );\n    }\n\n    // accs\n    if (acc.check && 2 === acc.check.length) {\n        warn();\n        acc._thunk_check = acc.check;\n        acc.check = promisify(acc._thunk_check);\n    }\n    if (acc.set && 3 === acc.set.length) {\n        warn();\n        acc._thunk_set = acc.set;\n        acc.set = promisify(acc._thunk_set);\n    }\n    if (2 === acc.checkKeypair.length) {\n        warn();\n        acc._thunk_checkKeypair = acc.checkKeypair;\n        acc.checkKeypair = promisify(acc._thunk_checkKeypair);\n    }\n    if (3 === acc.setKeypair.length) {\n        warn();\n        acc._thunk_setKeypair = acc.setKeypair;\n        acc.setKeypair = promisify(acc._thunk_setKeypair);\n    }\n\n    // certs\n    if (2 === crt.check.length) {\n        warn();\n        crt._thunk_check = crt.check;\n        crt.check = promisify(crt._thunk_check);\n    }\n    if (3 === crt.set.length) {\n        warn();\n        crt._thunk_set = crt.set;\n        crt.set = promisify(crt._thunk_set);\n    }\n    if (2 === crt.checkKeypair.length) {\n        warn();\n        crt._thunk_checkKeypair = crt.checkKeypair;\n        crt.checkKeypair = promisify(crt._thunk_checkKeypair);\n    }\n    if (2 === crt.setKeypair.length) {\n        warn();\n        crt._thunk_setKeypair = crt.setKeypair;\n        crt.setKeypair = promisify(crt._thunk_setKeypair);\n    }\n\n    return store;\n};\nP._normalizeChallenge = function(name, ch) {\n    var gch = {};\n    var warned = false;\n    function warn() {\n        if (warned) {\n            return;\n        }\n        warned = true;\n        console.warn(\n            \"'\" +\n                name +\n                \"' may have incorrect function signatures, or contains deprecated use of callbacks\"\n        );\n    }\n\n    var warned2 = false;\n    function warn2() {\n        if (warned2) {\n            return;\n        }\n        warned2 = true;\n        console.warn(\n            \"'\" +\n                name +\n                \"' did not return a Promise when called. This should be fixed by the maintainer.\"\n        );\n    }\n\n    function wrappy(fn) {\n        return function(_params) {\n            return Promise.resolve().then(function() {\n                var result = fn.call(ch, _params);\n                if (!result || !result.then) {\n                    warn2();\n                }\n                return result;\n            });\n        };\n    }\n\n    // init, zones, set, get, remove, propagationDelay\n    if (ch.init) {\n        if (2 === ch.init.length) {\n            warn();\n            ch._thunk_init = ch.init;\n            ch.init = promisify(ch._thunk_init);\n        }\n        gch.init = wrappy(ch.init);\n    }\n    if (ch.zones) {\n        if (2 === ch.zones.length) {\n            warn();\n            ch._thunk_zones = ch.zones;\n            ch.zones = promisify(ch._thunk_zones);\n        }\n        gch.zones = wrappy(ch.zones);\n    }\n    if (2 === ch.set.length) {\n        warn();\n        ch._thunk_set = ch.set;\n        ch.set = promisify(ch._thunk_set);\n    }\n    gch.set = wrappy(ch.set);\n    if (2 === ch.remove.length) {\n        warn();\n        ch._thunk_remove = ch.remove;\n        ch.remove = promisify(ch._thunk_remove);\n    }\n    gch.remove = wrappy(ch.remove);\n    if (ch.get) {\n        if (2 === ch.get.length) {\n            warn();\n            ch._thunk_get = ch.get;\n            ch.get = promisify(ch._thunk_get);\n        }\n        gch.get = wrappy(ch.get);\n    }\n    if(\"number\" === typeof ch.propagationDelay) {\n        gch.propagationDelay = ch.propagationDelay;\n    }\n\n    return gch;\n};\n\nP._loadSync = function(modname) {\n    try {\n        return require(modname);\n    } catch (e) {\n        console.error(\"Could not load '%s'\", modname);\n        console.error('Did you install it?');\n        console.error('\\tnpm install --save %s', modname);\n        e.context = 'load_plugin';\n        throw e;\n    }\n    /*\n\ttry {\n\t\tmod = require(modname);\n\t} catch (e) {\n\t\tP._installSync(modname);\n\t\tmod = require(modname);\n\t}\n  */\n};\n\nP._installSync = function(moduleName) {\n    try {\n        return require(moduleName);\n    } catch (e) {\n        // continue\n    }\n    var npm = 'npm';\n    var args = ['install', '--save', moduleName];\n    var out = '';\n    var cmd;\n\n    try {\n        cmd = spawnSync(npm, args, {\n            cwd: P.PKG_DIR,\n            windowsHide: true\n        });\n    } catch (e) {\n        console.error(\n            \"Failed to start: '\" +\n                npm +\n                ' ' +\n                args.join(' ') +\n                \"' in '\" +\n                P.PKG_DIR +\n                \"'\"\n        );\n        console.error(e.message);\n        process.exit(1);\n    }\n\n    if (!cmd.status) {\n        return;\n    }\n\n    out += cmd.stdout.toString('utf8');\n    out += cmd.stderr.toString('utf8');\n\n    if (out) {\n        console.error(out);\n        console.error();\n        console.error();\n    }\n\n    console.error(\n        \"Failed to run: '\" +\n            npm +\n            ' ' +\n            args.join(' ') +\n            \"' in '\" +\n            P.PKG_DIR +\n            \"'\"\n    );\n\n    console.error(\n        'Try for yourself:\\n\\tcd ' + P.PKG_DIR + '\\n\\tnpm ' + args.join(' ')\n    );\n\n    process.exit(1);\n};\n\nP._install = function(moduleName) {\n    return new Promise(function(resolve) {\n        if (!moduleName) {\n            throw new Error('no module name given');\n        }\n\n        var npm = 'npm';\n        var args = ['install', '--save', moduleName];\n        var out = '';\n        var cmd = spawn(npm, args, {\n            cwd: P.PKG_DIR,\n            windowsHide: true\n        });\n\n        cmd.stdout.on('data', function(chunk) {\n            out += chunk.toString('utf8');\n        });\n        cmd.stdout.on('data', function(chunk) {\n            out += chunk.toString('utf8');\n        });\n\n        cmd.on('error', function(e) {\n            console.error(\n                \"Failed to start: '\" +\n                    npm +\n                    ' ' +\n                    args.join(' ') +\n                    \"' in '\" +\n                    P.PKG_DIR +\n                    \"'\"\n            );\n            console.error(e.message);\n            process.exit(1);\n        });\n\n        cmd.on('exit', function(code) {\n            if (!code) {\n                resolve();\n                return;\n            }\n\n            if (out) {\n                console.error(out);\n                console.error();\n                console.error();\n            }\n            console.error(\n                \"Failed to run: '\" +\n                    npm +\n                    ' ' +\n                    args.join(' ') +\n                    \"' in '\" +\n                    P.PKG_DIR +\n                    \"'\"\n            );\n            console.error(\n                'Try for yourself:\\n\\tcd ' +\n                    P.PKG_DIR +\n                    '\\n\\tnpm ' +\n                    args.join(' ')\n            );\n            process.exit(1);\n        });\n    });\n};\n\nif (require.main === module) {\n    P._installSync(process.argv[2]);\n}\n"]},"metadata":{},"sourceType":"script"}