{"ast":null,"code":"'use strict';\n\nvar http = require('http');\n\nvar https = require('https');\n\nvar url = require('url');\n\nvar os = require('os');\n\nvar pkg = require('./package.json');\n\nvar fs = require('fs'); // only for streams\n\n\nfunction debug() {\n  if (module.exports.debug) {\n    console.log.apply(console, arguments);\n  }\n}\n\nfunction mergeOrDelete(defaults, updates) {\n  Object.keys(defaults).forEach(function (key) {\n    if (!(key in updates)) {\n      updates[key] = defaults[key];\n      return;\n    } // neither accept the prior default nor define an explicit value\n    // CRDT probs...\n\n\n    if ('undefined' === typeof updates[key]) {\n      delete updates[key];\n    } else if ('object' === typeof defaults[key] && 'object' === typeof updates[key]) {\n      updates[key] = mergeOrDelete(defaults[key], updates[key]);\n    }\n  });\n  return updates;\n} // retrieves an existing header, case-sensitive\n\n\nfunction getHeaderName(reqOpts, header) {\n  var headerNames = {};\n  Object.keys(reqOpts.headers).forEach(function (casedName) {\n    headerNames[casedName.toLowerCase()] = casedName;\n  }); // returns the key, which in erroneous cases could be an empty string\n\n  return headerNames[header.toLowerCase()];\n} // returns whether or not a header exists, case-insensitive\n\n\nfunction hasHeader(reqOpts, header) {\n  return 'undefined' !== typeof getHeaderName(reqOpts, header);\n}\n\nfunction toJSONifier(keys) {\n  return function () {\n    var obj = {};\n    var me = this;\n    keys.forEach(function (key) {\n      if (me[key] && 'function' === typeof me[key].toJSON) {\n        obj[key] = me[key].toJSON();\n      } else {\n        obj[key] = me[key];\n      }\n    });\n    return obj;\n  };\n}\n\nfunction setDefaults(defs) {\n  defs = defs || {};\n\n  function urequestHelper(opts, cb) {\n    debug('\\n[urequest] processed options:');\n    debug(opts);\n    var req;\n    var finalOpts = {};\n\n    function onResponse(resp) {\n      var followRedirect;\n      Object.keys(defs).forEach(function (key) {\n        if (key in opts && 'undefined' !== typeof opts[key]) {\n          return;\n        }\n\n        opts[key] = defs[key];\n      });\n      followRedirect = opts.followRedirect;\n      resp.toJSON = toJSONifier(['statusCode', 'body', 'headers', 'request']);\n      resp.request = req;\n      resp.request.uri = url.parse(opts.url); //resp.request.method = opts.method;\n\n      resp.request.headers = finalOpts.headers;\n      resp.request.toJSON = toJSONifier(['uri', 'method', 'headers']);\n\n      if (opts.debug) {\n        console.debug('[@root/request] Response Headers:');\n        console.debug(resp.toJSON());\n      }\n\n      if (followRedirect && resp.headers.location && -1 !== [301, 302, 307, 308].indexOf(resp.statusCode)) {\n        debug('Following redirect: ' + resp.headers.location);\n\n        if ('GET' !== opts.method && !opts.followAllRedirects) {\n          followRedirect = false;\n        }\n\n        if (opts._redirectCount >= opts.maxRedirects) {\n          followRedirect = false;\n        }\n\n        if ('function' === opts.followRedirect) {\n          if (!opts.followRedirect(resp)) {\n            followRedirect = false;\n          }\n        }\n\n        if (followRedirect) {\n          if (!opts.followOriginalHttpMethod) {\n            opts.method = 'GET';\n            opts.body = null;\n            delete opts.headers[getHeaderName(opts, 'Content-Length')];\n            delete opts.headers[getHeaderName(opts, 'Transfer-Encoding')];\n          }\n\n          if (opts.removeRefererHeader && opts.headers) {\n            delete opts.headers.referer;\n          } // TODO needs baseUrl, maybe test for host / socketPath?\n\n\n          opts.url = resp.headers.location;\n          opts.uri = url.parse(opts.url);\n          return urequestHelper(opts, cb);\n        }\n      }\n\n      if (opts.stream) {\n        // make the response await-able\n        var resolve;\n        var reject;\n        resp.stream = new Promise(function (_resolve, _reject) {\n          resolve = _resolve;\n          reject = _reject;\n        }); // allow specifying a file\n\n        if ('string' === typeof opts.stream) {\n          try {\n            if (opts.debug) {\n              console.debug('[@root/request] file write stream created');\n            }\n\n            opts.stream = fs.createWriteStream(opts.stream);\n          } catch (e) {\n            cb(e);\n          }\n        } // or an existing write stream\n\n\n        if ('function' === typeof opts.stream.pipe) {\n          if (opts.debug) {\n            console.debug('[@root/request] stream piped');\n          }\n\n          resp.pipe(opts.stream);\n        }\n\n        resp.on('error', function (e) {\n          if (opts.debug) {\n            console.debug(\"[@root/request] stream 'error'\");\n            console.error(e.stack);\n          }\n\n          resp.destroy();\n\n          if ('function' === opts.stream.destroy) {\n            opts.stream.destroy(e);\n          }\n\n          reject(e);\n        });\n        resp.on('end', function () {\n          if (opts.debug) {\n            console.debug(\"[@root/request] stream 'end'\");\n          }\n\n          if ('function' === opts.stream.destroy) {\n            opts.stream.end(); // this will close the stream (i.e. sync to disk)\n\n            opts.stream.destroy();\n          }\n        });\n        resp.on('close', function () {\n          if (opts.debug) {\n            console.debug(\"[@root/request] stream 'close'\");\n          }\n\n          resolve();\n        }); // and in all cases, return the stream\n\n        cb(null, resp);\n        return;\n      }\n\n      if (null === opts.encoding) {\n        resp._body = [];\n      } else {\n        resp.body = '';\n      }\n\n      resp._bodyLength = 0;\n      resp.on('data', function (chunk) {\n        if ('string' === typeof resp.body) {\n          resp.body += chunk.toString(opts.encoding);\n        } else {\n          resp._body.push(chunk);\n\n          resp._bodyLength += chunk.length;\n        }\n      });\n      resp.on('end', function () {\n        if ('string' !== typeof resp.body) {\n          if (1 === resp._body.length) {\n            resp.body = resp._body[0];\n          } else {\n            resp.body = Buffer.concat(resp._body, resp._bodyLength);\n          }\n\n          resp._body = null;\n        }\n\n        if (opts.json && 'string' === typeof resp.body) {\n          // TODO I would parse based on Content-Type\n          // but request.js doesn't do that.\n          try {\n            resp.body = JSON.parse(resp.body);\n          } catch (e) {// ignore\n          }\n        }\n\n        debug('\\n[urequest] resp.toJSON():');\n\n        if (module.exports.debug) {\n          debug(resp.toJSON());\n        }\n\n        if (opts.debug) {\n          console.debug('[@root/request] Response Body:');\n          console.debug(resp.body);\n        }\n\n        cb(null, resp, resp.body);\n      });\n    }\n\n    var _body;\n\n    var MyFormData;\n    var form;\n    var formHeaders;\n    var requester;\n\n    if (opts.body) {\n      if (true === opts.json) {\n        _body = JSON.stringify(opts.body);\n      } else {\n        _body = opts.body;\n      }\n    } else if (opts.json && true !== opts.json) {\n      _body = JSON.stringify(opts.json);\n    } else if (opts.form) {\n      _body = Object.keys(opts.form).filter(function (key) {\n        if ('undefined' !== typeof opts.form[key]) {\n          return true;\n        }\n      }).map(function (key) {\n        return encodeURIComponent(key) + '=' + encodeURIComponent(String(opts.form[key]));\n      }).join('&');\n      opts.headers['Content-Type'] = 'application/x-www-form-urlencoded';\n    }\n\n    if ('string' === typeof _body) {\n      _body = Buffer.from(_body);\n    }\n\n    Object.keys(opts.uri).forEach(function (key) {\n      finalOpts[key] = opts.uri[key];\n    }); // A bug should be raised if request does it differently,\n    // but I think we're supposed to pass all acceptable options\n    // on to the raw http request\n\n    ['family', 'host', 'localAddress', 'agent', 'createConnection', 'timeout', 'setHost'].forEach(function (key) {\n      finalOpts[key] = opts.uri[key];\n    });\n    finalOpts.method = opts.method;\n    finalOpts.headers = JSON.parse(JSON.stringify(opts.headers));\n    var uaHeader = getHeaderName(finalOpts, 'User-Agent') || 'User-Agent'; // set a default user-agent\n\n    if (!finalOpts.headers[uaHeader]) {\n      if (false === finalOpts.headers[uaHeader]) {\n        delete finalOpts.headers[uaHeader];\n      } else {\n        finalOpts.headers[uaHeader] = getUserAgent(opts.userAgent);\n      }\n    }\n\n    if (_body) {\n      // Most APIs expect (or require) Content-Length except in the case of multipart uploads\n      // Transfer-Encoding: Chunked (the default) is generally only well-supported downstream\n      if ('undefined' !== typeof _body.byteLength || 'undefined' !== typeof _body.length) {\n        finalOpts.headers['Content-Length'] = _body.byteLength || _body.length;\n      }\n    }\n\n    if (opts.auth) {\n      // if opts.uri specifies auth it will be parsed by url.parse and passed directly to the http module\n      if ('string' !== typeof opts.auth) {\n        opts.auth = (opts.auth.user || opts.auth.username || '') + ':' + (opts.auth.pass || opts.auth.password || '');\n      }\n\n      if ('string' === typeof opts.auth) {\n        finalOpts.auth = opts.auth;\n      }\n\n      if (false === opts.sendImmediately) {\n        console.warn('[Warn] setting `sendImmediately: false` is not yet supported. Please open an issue if this is an important feature that you need.');\n      } // [request-compat]\n\n\n      if (opts.auth.bearer) {\n        // having a shortcut for base64 encoding makes sense, but this? Eh, whatevs...\n        finalOpts.header.Authorization = 'Bearer ' + opts.auth.bearer;\n      }\n    }\n\n    if (opts.formData) {\n      try {\n        MyFormData = opts.FormData || require('form-data'); // potential options https://github.com/felixge/node-combined-stream/blob/master/lib/combined_stream.js#L7-L15\n      } catch (e) {\n        console.error('urequest does not include extra dependencies by default');\n        console.error(\"if you need to use 'form-data' you may install it, like so:\");\n        console.error('  npm install --save form-data');\n        cb(e);\n        return;\n      }\n\n      try {\n        form = new MyFormData();\n        Object.keys(opts.formData).forEach(function (key) {\n          function add(key, data, opts) {\n            if (data.value) {\n              opts = data.options;\n              data = data.value;\n            }\n\n            form.append(key, data, opts);\n          }\n\n          if (Array.isArray(opts.formData[key])) {\n            opts.formData[key].forEach(function (data) {\n              add(key, data);\n            });\n          } else {\n            add(key, opts.formData[key]);\n          }\n        });\n      } catch (e) {\n        cb(e);\n        return;\n      }\n\n      formHeaders = form.getHeaders();\n      Object.keys(formHeaders).forEach(function (header) {\n        finalOpts.headers[header] = formHeaders[header];\n      });\n    } // TODO support unix sockets\n\n\n    if ('https:' === finalOpts.protocol) {\n      // https://nodejs.org/api/https.html#https_https_request_options_callback\n      debug('\\n[urequest] https.request(opts):');\n      debug(finalOpts);\n      requester = https;\n    } else if ('http:' === finalOpts.protocol) {\n      // https://nodejs.org/api/http.html#http_http_request_options_callback\n      debug('\\n[urequest] http.request(opts):');\n      debug(finalOpts);\n      requester = http;\n    } else {\n      cb(new Error(\"unknown protocol: '\" + opts.uri.protocol + \"'\"));\n      return;\n    }\n\n    if (form) {\n      debug(\"\\n[urequest] '\" + finalOpts.method + \"' (request) form\");\n      debug(formHeaders); // generally uploads don't use Chunked Encoding (some systems have issues with it)\n      // and I don't want to do the work to calculate the content-lengths. This seems to work.\n\n      req = form.submit(finalOpts, function (err, resp) {\n        if (err) {\n          cb(err);\n          return;\n        }\n\n        onResponse(resp);\n        resp.resume();\n      }); //req = requester.request(finalOpts, onResponse);\n      //req.on('error', cb);\n      //form.pipe(req);\n\n      return;\n    }\n\n    if (opts.debug) {\n      console.debug('');\n      console.debug('[@root/request] Request Options:');\n      console.debug(finalOpts);\n\n      if (_body) {\n        console.debug('[@root/request] Request Body:');\n        console.debug(opts.body || opts.form || opts.formData || opts.json);\n      }\n    }\n\n    req = requester.request(finalOpts, onResponse);\n    req.on('error', cb);\n\n    if (_body) {\n      debug(\"\\n[urequest] '\" + finalOpts.method + \"' (request) body\");\n      debug(_body);\n\n      if ('function' === typeof _body.pipe) {\n        // used for chunked encoding\n        _body.pipe(req);\n\n        _body.on('error', function (err) {\n          // https://nodejs.org/api/stream.html#stream_readable_pipe_destination_options\n          // if the Readable stream emits an error during processing,\n          // the Writable destination is not closed automatically\n          _body.destroy();\n\n          req.destroy(err);\n        });\n      } else {\n        // used for known content-length\n        req.end(_body);\n      }\n    } else {\n      req.end();\n    }\n  }\n\n  function parseUrl(str) {\n    var obj = url.parse(str);\n    var paths;\n\n    if ('unix' !== (obj.hostname || obj.host || '').toLowerCase()) {\n      return obj;\n    }\n\n    obj.href = null;\n    obj.hostname = obj.host = null;\n    paths = (obj.pathname || obj.path || '').split(':');\n    obj.socketPath = paths.shift();\n    obj.pathname = obj.path = paths.join(':');\n    return obj;\n  }\n\n  function urequest(opts, cb) {\n    debug('\\n[urequest] received options:');\n    debug(opts);\n    var reqOpts = {}; // request.js behavior:\n    // encoding: null + json ? unknown\n    // json => attempt to parse, fail silently\n    // encoding => buffer.toString(encoding)\n    // null === encoding => Buffer.concat(buffers)\n\n    if ('string' === typeof opts) {\n      opts = {\n        url: opts\n      };\n    }\n\n    module.exports._keys.forEach(function (key) {\n      if (key in opts && 'undefined' !== typeof opts[key]) {\n        reqOpts[key] = opts[key];\n      } else if (key in defs) {\n        reqOpts[key] = defs[key];\n      }\n    }); // TODO url.resolve(defs.baseUrl, opts.url);\n\n\n    if ('string' === typeof opts.url || 'string' === typeof opts.uri) {\n      if ('string' === typeof opts.url) {\n        reqOpts.url = opts.url;\n        reqOpts.uri = parseUrl(opts.url);\n      } else if ('string' === typeof opts.uri) {\n        reqOpts.url = opts.uri;\n        reqOpts.uri = parseUrl(opts.uri);\n      }\n    } else {\n      if ('object' === typeof opts.uri) {\n        reqOpts.url = url.format(opts.uri);\n        reqOpts.uri = opts.uri; //reqOpts.uri = url.parse(reqOpts.uri);\n      } else if ('object' === typeof opts.url) {\n        reqOpts.url = url.format(opts.url);\n        reqOpts.uri = opts.url; //reqOpts.uri = url.parse(reqOpts.url);\n      }\n    }\n\n    if (opts.body || opts.json && true !== opts.json || opts.form || opts.formData) {\n      // TODO this is probably a deviation from request's API\n      // need to check and probably eliminate it\n      reqOpts.method = (reqOpts.method || 'POST').toUpperCase();\n    } else {\n      reqOpts.method = (reqOpts.method || 'GET').toUpperCase();\n    }\n\n    if (!reqOpts.headers) {\n      reqOpts.headers = {};\n    } // crazy case for easier testing\n\n\n    if (!hasHeader(reqOpts, 'CoNTeNT-TyPe')) {\n      if (true === reqOpts.json && reqOpts.body || true !== reqOpts.json && reqOpts.json) {\n        reqOpts.headers['Content-Type'] = 'application/json';\n      }\n    }\n\n    if (opts.debug) {\n      reqOpts.debug = opts.debug;\n    }\n\n    return urequestHelper(reqOpts, cb);\n  }\n\n  function smartPromisify(fn) {\n    return function (opts) {\n      var cb;\n\n      if ('function' === typeof arguments[1]) {\n        cb = Array.prototype.slice.call(arguments)[1];\n        return fn(opts, cb);\n      }\n\n      return new Promise(function (resolve, reject) {\n        fn(opts, function (err, resp) {\n          if (err) {\n            err._response = resp;\n            reject(err);\n            return;\n          }\n\n          resolve(resp);\n        });\n      });\n    };\n  }\n\n  var smartUrequest = smartPromisify(urequest);\n\n  smartUrequest.defaults = function (_defs) {\n    _defs = mergeOrDelete(defs, _defs);\n    return setDefaults(_defs);\n  };\n\n  ['get', 'put', 'post', 'patch', 'delete', 'head', 'options'].forEach(function (method) {\n    smartUrequest[method] = smartPromisify(function (obj, cb) {\n      if ('string' === typeof obj) {\n        obj = {\n          url: obj\n        };\n      }\n\n      obj.method = method.toUpperCase();\n      urequest(obj, cb);\n    });\n  });\n  smartUrequest.del = urequest.delete;\n  return smartUrequest;\n}\n\nvar nodeUa = '@root+request/' + pkg.version + ' ' + process.release.name + '/' + process.version + ' ' + os.platform() + '/' + os.release() + ' ' + os.type() + '/' + process.arch;\n\nfunction getUserAgent(additional) {\n  // See https://tools.ietf.org/html/rfc8555#section-6.1\n  // And https://tools.ietf.org/html/rfc7231#section-5.5.3\n  // And https://community.letsencrypt.org/t/user-agent-flag-explained/3843/2\n  var ua = nodeUa;\n\n  if (additional) {\n    ua = additional + ' ' + ua;\n  }\n\n  return ua;\n}\n\nvar _defaults = {\n  sendImmediately: true,\n  method: '',\n  headers: {},\n  useQuerystring: false,\n  followRedirect: true,\n  followAllRedirects: false,\n  followOriginalHttpMethod: false,\n  maxRedirects: 10,\n  removeRefererHeader: false,\n  // encoding: undefined,\n  // stream: false, // TODO allow a stream?\n  gzip: false //, body: undefined\n  //, json: undefined\n\n};\nmodule.exports = setDefaults(_defaults);\nmodule.exports._keys = Object.keys(_defaults).concat(['encoding', 'stream', 'body', 'json', 'form', 'auth', 'formData', 'FormData', 'userAgent' // non-standard for request.js\n]);\nmodule.exports.debug = -1 !== (process.env.NODE_DEBUG || '').split(/\\s+/g).indexOf('urequest');\ndebug('DEBUG ON for urequest');","map":{"version":3,"sources":["/home/neil/Desktop/Programming/LetsCodeSBISD/Forwarder/node_modules/@root/request/index.js"],"names":["http","require","https","url","os","pkg","fs","debug","module","exports","console","log","apply","arguments","mergeOrDelete","defaults","updates","Object","keys","forEach","key","getHeaderName","reqOpts","header","headerNames","headers","casedName","toLowerCase","hasHeader","toJSONifier","obj","me","toJSON","setDefaults","defs","urequestHelper","opts","cb","req","finalOpts","onResponse","resp","followRedirect","request","uri","parse","location","indexOf","statusCode","method","followAllRedirects","_redirectCount","maxRedirects","followOriginalHttpMethod","body","removeRefererHeader","referer","stream","resolve","reject","Promise","_resolve","_reject","createWriteStream","e","pipe","on","error","stack","destroy","end","encoding","_body","_bodyLength","chunk","toString","push","length","Buffer","concat","json","JSON","MyFormData","form","formHeaders","requester","stringify","filter","map","encodeURIComponent","String","join","from","uaHeader","getUserAgent","userAgent","byteLength","auth","user","username","pass","password","sendImmediately","warn","bearer","Authorization","formData","FormData","add","data","value","options","append","Array","isArray","getHeaders","protocol","Error","submit","err","resume","parseUrl","str","paths","hostname","host","href","pathname","path","split","socketPath","shift","urequest","_keys","format","toUpperCase","smartPromisify","fn","prototype","slice","call","_response","smartUrequest","_defs","del","delete","nodeUa","version","process","release","name","platform","type","arch","additional","ua","_defaults","useQuerystring","gzip","env","NODE_DEBUG"],"mappings":"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","sourcesContent":["'use strict';\n\nvar http = require('http');\nvar https = require('https');\nvar url = require('url');\nvar os = require('os');\nvar pkg = require('./package.json');\nvar fs = require('fs'); // only for streams\n\nfunction debug() {\n    if (module.exports.debug) {\n        console.log.apply(console, arguments);\n    }\n}\n\nfunction mergeOrDelete(defaults, updates) {\n    Object.keys(defaults).forEach(function (key) {\n        if (!(key in updates)) {\n            updates[key] = defaults[key];\n            return;\n        }\n\n        // neither accept the prior default nor define an explicit value\n        // CRDT probs...\n        if ('undefined' === typeof updates[key]) {\n            delete updates[key];\n        } else if (\n            'object' === typeof defaults[key] &&\n            'object' === typeof updates[key]\n        ) {\n            updates[key] = mergeOrDelete(defaults[key], updates[key]);\n        }\n    });\n\n    return updates;\n}\n\n// retrieves an existing header, case-sensitive\nfunction getHeaderName(reqOpts, header) {\n    var headerNames = {};\n    Object.keys(reqOpts.headers).forEach(function (casedName) {\n        headerNames[casedName.toLowerCase()] = casedName;\n    });\n    // returns the key, which in erroneous cases could be an empty string\n    return headerNames[header.toLowerCase()];\n}\n// returns whether or not a header exists, case-insensitive\nfunction hasHeader(reqOpts, header) {\n    return 'undefined' !== typeof getHeaderName(reqOpts, header);\n}\n\nfunction toJSONifier(keys) {\n    return function () {\n        var obj = {};\n        var me = this;\n\n        keys.forEach(function (key) {\n            if (me[key] && 'function' === typeof me[key].toJSON) {\n                obj[key] = me[key].toJSON();\n            } else {\n                obj[key] = me[key];\n            }\n        });\n\n        return obj;\n    };\n}\n\nfunction setDefaults(defs) {\n    defs = defs || {};\n\n    function urequestHelper(opts, cb) {\n        debug('\\n[urequest] processed options:');\n        debug(opts);\n\n        var req;\n        var finalOpts = {};\n\n        function onResponse(resp) {\n            var followRedirect;\n\n            Object.keys(defs).forEach(function (key) {\n                if (key in opts && 'undefined' !== typeof opts[key]) {\n                    return;\n                }\n                opts[key] = defs[key];\n            });\n            followRedirect = opts.followRedirect;\n\n            resp.toJSON = toJSONifier([\n                'statusCode',\n                'body',\n                'headers',\n                'request'\n            ]);\n\n            resp.request = req;\n            resp.request.uri = url.parse(opts.url);\n            //resp.request.method = opts.method;\n            resp.request.headers = finalOpts.headers;\n            resp.request.toJSON = toJSONifier(['uri', 'method', 'headers']);\n            if (opts.debug) {\n                console.debug('[@root/request] Response Headers:');\n                console.debug(resp.toJSON());\n            }\n\n            if (\n                followRedirect &&\n                resp.headers.location &&\n                -1 !== [301, 302, 307, 308].indexOf(resp.statusCode)\n            ) {\n                debug('Following redirect: ' + resp.headers.location);\n                if ('GET' !== opts.method && !opts.followAllRedirects) {\n                    followRedirect = false;\n                }\n                if (opts._redirectCount >= opts.maxRedirects) {\n                    followRedirect = false;\n                }\n                if ('function' === opts.followRedirect) {\n                    if (!opts.followRedirect(resp)) {\n                        followRedirect = false;\n                    }\n                }\n                if (followRedirect) {\n                    if (!opts.followOriginalHttpMethod) {\n                        opts.method = 'GET';\n                        opts.body = null;\n                        delete opts.headers[\n                            getHeaderName(opts, 'Content-Length')\n                        ];\n                        delete opts.headers[\n                            getHeaderName(opts, 'Transfer-Encoding')\n                        ];\n                    }\n                    if (opts.removeRefererHeader && opts.headers) {\n                        delete opts.headers.referer;\n                    }\n                    // TODO needs baseUrl, maybe test for host / socketPath?\n                    opts.url = resp.headers.location;\n                    opts.uri = url.parse(opts.url);\n                    return urequestHelper(opts, cb);\n                }\n            }\n\n            if (opts.stream) {\n                // make the response await-able\n                var resolve;\n                var reject;\n                resp.stream = new Promise(function (_resolve, _reject) {\n                    resolve = _resolve;\n                    reject = _reject;\n                });\n\n                // allow specifying a file\n                if ('string' === typeof opts.stream) {\n                    try {\n                        if (opts.debug) {\n                            console.debug(\n                                '[@root/request] file write stream created'\n                            );\n                        }\n                        opts.stream = fs.createWriteStream(opts.stream);\n                    } catch (e) {\n                        cb(e);\n                    }\n                }\n                // or an existing write stream\n                if ('function' === typeof opts.stream.pipe) {\n                    if (opts.debug) {\n                        console.debug('[@root/request] stream piped');\n                    }\n                    resp.pipe(opts.stream);\n                }\n                resp.on('error', function (e) {\n                    if (opts.debug) {\n                        console.debug(\"[@root/request] stream 'error'\");\n                        console.error(e.stack);\n                    }\n                    resp.destroy();\n                    if ('function' === opts.stream.destroy) {\n                        opts.stream.destroy(e);\n                    }\n                    reject(e);\n                });\n                resp.on('end', function () {\n                    if (opts.debug) {\n                        console.debug(\"[@root/request] stream 'end'\");\n                    }\n                    if ('function' === opts.stream.destroy) {\n                        opts.stream.end();\n                        // this will close the stream (i.e. sync to disk)\n                        opts.stream.destroy();\n                    }\n                });\n                resp.on('close', function () {\n                    if (opts.debug) {\n                        console.debug(\"[@root/request] stream 'close'\");\n                    }\n                    resolve();\n                });\n                // and in all cases, return the stream\n                cb(null, resp);\n                return;\n            }\n\n            if (null === opts.encoding) {\n                resp._body = [];\n            } else {\n                resp.body = '';\n            }\n            resp._bodyLength = 0;\n            resp.on('data', function (chunk) {\n                if ('string' === typeof resp.body) {\n                    resp.body += chunk.toString(opts.encoding);\n                } else {\n                    resp._body.push(chunk);\n                    resp._bodyLength += chunk.length;\n                }\n            });\n            resp.on('end', function () {\n                if ('string' !== typeof resp.body) {\n                    if (1 === resp._body.length) {\n                        resp.body = resp._body[0];\n                    } else {\n                        resp.body = Buffer.concat(resp._body, resp._bodyLength);\n                    }\n                    resp._body = null;\n                }\n                if (opts.json && 'string' === typeof resp.body) {\n                    // TODO I would parse based on Content-Type\n                    // but request.js doesn't do that.\n                    try {\n                        resp.body = JSON.parse(resp.body);\n                    } catch (e) {\n                        // ignore\n                    }\n                }\n\n                debug('\\n[urequest] resp.toJSON():');\n                if (module.exports.debug) {\n                    debug(resp.toJSON());\n                }\n                if (opts.debug) {\n                    console.debug('[@root/request] Response Body:');\n                    console.debug(resp.body);\n                }\n                cb(null, resp, resp.body);\n            });\n        }\n\n        var _body;\n        var MyFormData;\n        var form;\n        var formHeaders;\n        var requester;\n\n        if (opts.body) {\n            if (true === opts.json) {\n                _body = JSON.stringify(opts.body);\n            } else {\n                _body = opts.body;\n            }\n        } else if (opts.json && true !== opts.json) {\n            _body = JSON.stringify(opts.json);\n        } else if (opts.form) {\n            _body = Object.keys(opts.form)\n                .filter(function (key) {\n                    if ('undefined' !== typeof opts.form[key]) {\n                        return true;\n                    }\n                })\n                .map(function (key) {\n                    return (\n                        encodeURIComponent(key) +\n                        '=' +\n                        encodeURIComponent(String(opts.form[key]))\n                    );\n                })\n                .join('&');\n            opts.headers['Content-Type'] = 'application/x-www-form-urlencoded';\n        }\n        if ('string' === typeof _body) {\n            _body = Buffer.from(_body);\n        }\n\n        Object.keys(opts.uri).forEach(function (key) {\n            finalOpts[key] = opts.uri[key];\n        });\n\n        // A bug should be raised if request does it differently,\n        // but I think we're supposed to pass all acceptable options\n        // on to the raw http request\n        [\n            'family',\n            'host',\n            'localAddress',\n            'agent',\n            'createConnection',\n            'timeout',\n            'setHost'\n        ].forEach(function (key) {\n            finalOpts[key] = opts.uri[key];\n        });\n\n        finalOpts.method = opts.method;\n        finalOpts.headers = JSON.parse(JSON.stringify(opts.headers));\n\n        var uaHeader = getHeaderName(finalOpts, 'User-Agent') || 'User-Agent';\n        // set a default user-agent\n        if (!finalOpts.headers[uaHeader]) {\n            if (false === finalOpts.headers[uaHeader]) {\n                delete finalOpts.headers[uaHeader];\n            } else {\n                finalOpts.headers[uaHeader] = getUserAgent(opts.userAgent);\n            }\n        }\n        if (_body) {\n            // Most APIs expect (or require) Content-Length except in the case of multipart uploads\n            // Transfer-Encoding: Chunked (the default) is generally only well-supported downstream\n            if (\n                'undefined' !== typeof _body.byteLength ||\n                'undefined' !== typeof _body.length\n            ) {\n                finalOpts.headers['Content-Length'] =\n                    _body.byteLength || _body.length;\n            }\n        }\n        if (opts.auth) {\n            // if opts.uri specifies auth it will be parsed by url.parse and passed directly to the http module\n            if ('string' !== typeof opts.auth) {\n                opts.auth =\n                    (opts.auth.user || opts.auth.username || '') +\n                    ':' +\n                    (opts.auth.pass || opts.auth.password || '');\n            }\n            if ('string' === typeof opts.auth) {\n                finalOpts.auth = opts.auth;\n            }\n            if (false === opts.sendImmediately) {\n                console.warn(\n                    '[Warn] setting `sendImmediately: false` is not yet supported. Please open an issue if this is an important feature that you need.'\n                );\n            }\n            // [request-compat]\n            if (opts.auth.bearer) {\n                // having a shortcut for base64 encoding makes sense, but this? Eh, whatevs...\n                finalOpts.header.Authorization = 'Bearer ' + opts.auth.bearer;\n            }\n        }\n        if (opts.formData) {\n            try {\n                MyFormData = opts.FormData || require('form-data');\n                // potential options https://github.com/felixge/node-combined-stream/blob/master/lib/combined_stream.js#L7-L15\n            } catch (e) {\n                console.error(\n                    'urequest does not include extra dependencies by default'\n                );\n                console.error(\n                    \"if you need to use 'form-data' you may install it, like so:\"\n                );\n                console.error('  npm install --save form-data');\n                cb(e);\n                return;\n            }\n            try {\n                form = new MyFormData();\n                Object.keys(opts.formData).forEach(function (key) {\n                    function add(key, data, opts) {\n                        if (data.value) {\n                            opts = data.options;\n                            data = data.value;\n                        }\n                        form.append(key, data, opts);\n                    }\n                    if (Array.isArray(opts.formData[key])) {\n                        opts.formData[key].forEach(function (data) {\n                            add(key, data);\n                        });\n                    } else {\n                        add(key, opts.formData[key]);\n                    }\n                });\n            } catch (e) {\n                cb(e);\n                return;\n            }\n            formHeaders = form.getHeaders();\n            Object.keys(formHeaders).forEach(function (header) {\n                finalOpts.headers[header] = formHeaders[header];\n            });\n        }\n\n        // TODO support unix sockets\n        if ('https:' === finalOpts.protocol) {\n            // https://nodejs.org/api/https.html#https_https_request_options_callback\n            debug('\\n[urequest] https.request(opts):');\n            debug(finalOpts);\n            requester = https;\n        } else if ('http:' === finalOpts.protocol) {\n            // https://nodejs.org/api/http.html#http_http_request_options_callback\n            debug('\\n[urequest] http.request(opts):');\n            debug(finalOpts);\n            requester = http;\n        } else {\n            cb(new Error(\"unknown protocol: '\" + opts.uri.protocol + \"'\"));\n            return;\n        }\n\n        if (form) {\n            debug(\"\\n[urequest] '\" + finalOpts.method + \"' (request) form\");\n            debug(formHeaders);\n            // generally uploads don't use Chunked Encoding (some systems have issues with it)\n            // and I don't want to do the work to calculate the content-lengths. This seems to work.\n            req = form.submit(finalOpts, function (err, resp) {\n                if (err) {\n                    cb(err);\n                    return;\n                }\n                onResponse(resp);\n                resp.resume();\n            });\n            //req = requester.request(finalOpts, onResponse);\n            //req.on('error', cb);\n            //form.pipe(req);\n            return;\n        }\n\n        if (opts.debug) {\n            console.debug('');\n            console.debug('[@root/request] Request Options:');\n            console.debug(finalOpts);\n            if (_body) {\n                console.debug('[@root/request] Request Body:');\n                console.debug(\n                    opts.body || opts.form || opts.formData || opts.json\n                );\n            }\n        }\n        req = requester.request(finalOpts, onResponse);\n        req.on('error', cb);\n\n        if (_body) {\n            debug(\"\\n[urequest] '\" + finalOpts.method + \"' (request) body\");\n            debug(_body);\n            if ('function' === typeof _body.pipe) {\n                // used for chunked encoding\n                _body.pipe(req);\n                _body.on('error', function (err) {\n                    // https://nodejs.org/api/stream.html#stream_readable_pipe_destination_options\n                    // if the Readable stream emits an error during processing,\n                    // the Writable destination is not closed automatically\n                    _body.destroy();\n                    req.destroy(err);\n                });\n            } else {\n                // used for known content-length\n                req.end(_body);\n            }\n        } else {\n            req.end();\n        }\n    }\n\n    function parseUrl(str) {\n        var obj = url.parse(str);\n        var paths;\n        if ('unix' !== (obj.hostname || obj.host || '').toLowerCase()) {\n            return obj;\n        }\n\n        obj.href = null;\n        obj.hostname = obj.host = null;\n\n        paths = (obj.pathname || obj.path || '').split(':');\n\n        obj.socketPath = paths.shift();\n        obj.pathname = obj.path = paths.join(':');\n\n        return obj;\n    }\n\n    function urequest(opts, cb) {\n        debug('\\n[urequest] received options:');\n        debug(opts);\n        var reqOpts = {};\n        // request.js behavior:\n        // encoding: null + json ? unknown\n        // json => attempt to parse, fail silently\n        // encoding => buffer.toString(encoding)\n        // null === encoding => Buffer.concat(buffers)\n        if ('string' === typeof opts) {\n            opts = { url: opts };\n        }\n\n        module.exports._keys.forEach(function (key) {\n            if (key in opts && 'undefined' !== typeof opts[key]) {\n                reqOpts[key] = opts[key];\n            } else if (key in defs) {\n                reqOpts[key] = defs[key];\n            }\n        });\n\n        // TODO url.resolve(defs.baseUrl, opts.url);\n        if ('string' === typeof opts.url || 'string' === typeof opts.uri) {\n            if ('string' === typeof opts.url) {\n                reqOpts.url = opts.url;\n                reqOpts.uri = parseUrl(opts.url);\n            } else if ('string' === typeof opts.uri) {\n                reqOpts.url = opts.uri;\n                reqOpts.uri = parseUrl(opts.uri);\n            }\n        } else {\n            if ('object' === typeof opts.uri) {\n                reqOpts.url = url.format(opts.uri);\n                reqOpts.uri = opts.uri;\n                //reqOpts.uri = url.parse(reqOpts.uri);\n            } else if ('object' === typeof opts.url) {\n                reqOpts.url = url.format(opts.url);\n                reqOpts.uri = opts.url;\n                //reqOpts.uri = url.parse(reqOpts.url);\n            }\n        }\n\n        if (\n            opts.body ||\n            (opts.json && true !== opts.json) ||\n            opts.form ||\n            opts.formData\n        ) {\n            // TODO this is probably a deviation from request's API\n            // need to check and probably eliminate it\n            reqOpts.method = (reqOpts.method || 'POST').toUpperCase();\n        } else {\n            reqOpts.method = (reqOpts.method || 'GET').toUpperCase();\n        }\n        if (!reqOpts.headers) {\n            reqOpts.headers = {};\n        }\n\n        // crazy case for easier testing\n        if (!hasHeader(reqOpts, 'CoNTeNT-TyPe')) {\n            if (\n                (true === reqOpts.json && reqOpts.body) ||\n                (true !== reqOpts.json && reqOpts.json)\n            ) {\n                reqOpts.headers['Content-Type'] = 'application/json';\n            }\n        }\n\n        if (opts.debug) {\n            reqOpts.debug = opts.debug;\n        }\n        return urequestHelper(reqOpts, cb);\n    }\n\n    function smartPromisify(fn) {\n        return function (opts) {\n            var cb;\n            if ('function' === typeof arguments[1]) {\n                cb = Array.prototype.slice.call(arguments)[1];\n                return fn(opts, cb);\n            }\n            return new Promise(function (resolve, reject) {\n                fn(opts, function (err, resp) {\n                    if (err) {\n                        err._response = resp;\n                        reject(err);\n                        return;\n                    }\n                    resolve(resp);\n                });\n            });\n        };\n    }\n\n    var smartUrequest = smartPromisify(urequest);\n\n    smartUrequest.defaults = function (_defs) {\n        _defs = mergeOrDelete(defs, _defs);\n        return setDefaults(_defs);\n    };\n    ['get', 'put', 'post', 'patch', 'delete', 'head', 'options'].forEach(\n        function (method) {\n            smartUrequest[method] = smartPromisify(function (obj, cb) {\n                if ('string' === typeof obj) {\n                    obj = { url: obj };\n                }\n                obj.method = method.toUpperCase();\n                urequest(obj, cb);\n            });\n        }\n    );\n    smartUrequest.del = urequest.delete;\n\n    return smartUrequest;\n}\n\nvar nodeUa =\n    '@root+request/' +\n    pkg.version +\n    ' ' +\n    process.release.name +\n    '/' +\n    process.version +\n    ' ' +\n    os.platform() +\n    '/' +\n    os.release() +\n    ' ' +\n    os.type() +\n    '/' +\n    process.arch;\nfunction getUserAgent(additional) {\n    // See https://tools.ietf.org/html/rfc8555#section-6.1\n    // And https://tools.ietf.org/html/rfc7231#section-5.5.3\n    // And https://community.letsencrypt.org/t/user-agent-flag-explained/3843/2\n\n    var ua = nodeUa;\n    if (additional) {\n        ua = additional + ' ' + ua;\n    }\n\n    return ua;\n}\n\nvar _defaults = {\n    sendImmediately: true,\n    method: '',\n    headers: {},\n    useQuerystring: false,\n    followRedirect: true,\n    followAllRedirects: false,\n    followOriginalHttpMethod: false,\n    maxRedirects: 10,\n    removeRefererHeader: false,\n    // encoding: undefined,\n    // stream: false, // TODO allow a stream?\n    gzip: false\n    //, body: undefined\n    //, json: undefined\n};\nmodule.exports = setDefaults(_defaults);\n\nmodule.exports._keys = Object.keys(_defaults).concat([\n    'encoding',\n    'stream',\n    'body',\n    'json',\n    'form',\n    'auth',\n    'formData',\n    'FormData',\n    'userAgent' // non-standard for request.js\n]);\nmodule.exports.debug =\n    -1 !== (process.env.NODE_DEBUG || '').split(/\\s+/g).indexOf('urequest');\n\ndebug('DEBUG ON for urequest');\n"]},"metadata":{},"sourceType":"script"}